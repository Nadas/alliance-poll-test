<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alliance Play Time Poll</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a;
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            color: #e0e0e0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #141414;
            border-radius: 8px;
            border: 1px solid #262626;
            overflow: hidden;
        }

        .header {
            background: #141414;
            border-bottom: 1px solid #262626;
            padding: 24px 30px;
            position: relative;
        }

        .header h1 {
            font-size: 1.5em;
            margin-bottom: 4px;
            color: #ffffff;
            font-weight: 600;
        }

        .header p {
            color: #888;
            font-size: 0.9em;
        }

        .admin-link {
            position: absolute;
            top: 24px;
            right: 30px;
            color: #ffffff;
            text-decoration: none;
            padding: 6px 12px;
            border: 1px solid #262626;
            border-radius: 4px;
            font-size: 0.85em;
            transition: background 0.2s ease;
        }

        .admin-link:hover {
            background: #1a1a1a;
        }

        .content {
            padding: 30px;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #888;
        }

        .loading-spinner {
            border: 3px solid #262626;
            border-top: 3px solid #ffffff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .create-section {
            background: #1a1a1a;
            padding: 24px;
            border-radius: 4px;
            margin-bottom: 24px;
            border: 1px solid #262626;
        }

        .create-section h2 {
            color: #ffffff;
            margin-bottom: 8px;
            font-size: 1.2em;
            font-weight: 600;
        }

        .create-section p {
            color: #888;
            font-size: 0.9em;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 6px;
            font-weight: 500;
            color: #e0e0e0;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #262626;
            border-radius: 4px;
            font-size: 0.95em;
            transition: border-color 0.2s ease;
            font-family: inherit;
            background: #0a0a0a;
            color: #e0e0e0;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 70px;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #ffffff;
        }

        .form-group input::placeholder,
        .form-group textarea::placeholder {
            color: #555;
        }

        .divider {
            text-align: center;
            margin: 24px 0;
            color: #555;
            font-size: 0.85em;
        }

        .poll-info {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 24px;
            border-left: 3px solid #ffffff;
        }

        .poll-info h3 {
            color: #ffffff;
            margin-bottom: 8px;
            font-size: 1.1em;
            font-weight: 600;
        }

        .poll-info p {
            color: #888;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .share-link {
            background: #0a0a0a;
            padding: 10px;
            border-radius: 4px;
            margin-top: 12px;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid #262626;
            font-size: 0.85em;
        }

        .share-link input {
            flex: 1;
            border: none;
            background: transparent;
            font-family: 'Courier New', monospace;
            color: #e0e0e0;
            font-size: 0.85em;
        }

        .instructions {
            background: #1a1a1a;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 20px;
            color: #888;
            border: 1px solid #262626;
            font-size: 0.9em;
        }

        .name-input-section {
            margin-bottom: 24px;
            background: #1a1a1a;
            padding: 16px;
            border-radius: 4px;
            border: 1px solid #262626;
        }

        .name-input-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #e0e0e0;
            font-size: 0.9em;
        }

        .name-input-section input {
            width: 100%;
            padding: 10px;
            border: 1px solid #262626;
            border-radius: 4px;
            font-size: 0.95em;
            transition: border-color 0.2s ease;
            background: #0a0a0a;
            color: #e0e0e0;
        }

        .name-input-section input:focus {
            outline: none;
            border-color: #ffffff;
        }

        .name-input-section input::placeholder {
            color: #555;
        }

        #timeSlots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 8px;
            margin-bottom: 20px;
        }

        .time-slot {
            background: #1a1a1a;
            border: 1px solid #262626;
            border-radius: 4px;
            padding: 10px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .time-slot:hover {
            border-color: #ffffff;
            background: #202020;
        }

        .time-slot.selected {
            background: #ffffff;
            border-color: #ffffff;
            color: #0a0a0a;
        }

        .time-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .time-label {
            font-size: 0.85em;
            font-weight: 500;
        }

        .vote-count {
            background: rgba(255,255,255,0.1);
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.75em;
        }

        .time-slot.selected .vote-count {
            background: rgba(0,0,0,0.2);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 0.95em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: #ffffff;
            color: #0a0a0a;
            width: 100%;
        }

        .btn-secondary {
            background: #333;
            color: #ffffff;
        }

        .btn-success {
            background: #28a745;
            color: #ffffff;
        }

        .results-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #262626;
        }

        .results-title {
            font-size: 1.1em;
            font-weight: 600;
            margin-bottom: 16px;
            color: #ffffff;
        }

        .voter-list {
            background: #1a1a1a;
            padding: 12px;
            border-radius: 4px;
            margin-top: 8px;
            font-size: 0.85em;
            color: #888;
        }

        .message {
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 16px;
            font-size: 0.9em;
        }

        .message.success {
            background: #1a3a1a;
            color: #4ade80;
            border: 1px solid #2a4a2a;
        }

        .message.error {
            background: #3a1a1a;
            color: #f87171;
            border: 1px solid #4a2a2a;
        }

        .copy-btn {
            background: #ffffff;
            color: #0a0a0a;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85em;
            transition: opacity 0.2s ease;
        }

        .copy-btn:hover {
            opacity: 0.9;
        }

        .error-box {
            background: #3a1a1a;
            color: #f87171;
            padding: 24px;
            border-radius: 4px;
            border: 1px solid #4a2a2a;
            text-align: center;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #141414;
            border: 1px solid #262626;
            border-radius: 8px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
        }

        .modal-content h2 {
            color: #ffffff;
            margin-bottom: 16px;
            font-size: 1.3em;
        }

        .modal-content p {
            color: #888;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .credential-display {
            background: #1a1a1a;
            padding: 16px;
            border-radius: 4px;
            margin-bottom: 16px;
            border: 1px solid #262626;
        }

        .credential-display label {
            display: block;
            color: #888;
            font-size: 0.85em;
            margin-bottom: 8px;
        }

        .credential-display .value {
            color: #ffffff;
            font-family: 'Courier New', monospace;
            font-size: 1.1em;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-actions {
            display: flex;
            gap: 12px;
        }

        .modal-actions button {
            flex: 1;
        }

        .confirmation-box {
            background: #1a1a1a;
            padding: 20px;
            border-radius: 4px;
            margin-bottom: 20px;
            border: 1px solid #262626;
        }

        .confirmation-box h3 {
            color: #ffffff;
            margin-bottom: 12px;
            font-size: 1.1em;
        }

        .confirmation-box p {
            color: #888;
            margin-bottom: 16px;
            font-size: 0.9em;
        }

        .confirmation-actions {
            display: flex;
            gap: 12px;
        }

        .confirmation-actions button {
            flex: 1;
        }

        .btn-outline {
            background: transparent;
            color: #ffffff;
            border: 1px solid #262626;
        }

        .btn-outline:hover {
            background: #1a1a1a;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Alliance Play Time Poll</h1>
            <p>Vote for your preferred gaming schedule</p>
            <a href="admin.html" class="admin-link">Admin</a>
        </div>

        <div class="content">
            <div id="loadingScreen" class="loading">
                <div class="loading-spinner"></div>
                <p>Loading...</p>
            </div>

             
            <div class="create-section">
                <h2>Join Existing Poll</h2>
                <p style="color: #666; margin-bottom: 20px;">Already have a Poll ID? Enter it below.</p>
                    
                <div class="form-group">
                      <label for="pollIdInput">Poll ID:</label>
                     <input type="text" id="pollIdInput" placeholder="Enter 6-character Poll ID" maxlength="6">
                </div>

                 <button class="btn btn-success" onclick="joinPoll()">Join Poll</button>
            </div>
            
            <div class="divider">— OR —</div>
            
            <!-- Create New Poll Section -->
            <div id="createSection" style="display: none;">
                <div class="create-section">
                    <h2>Create a New Poll</h2>
                    <p style="color: #666; margin-bottom: 20px;">Start by providing details for your alliance poll.</p>
                    
                    <div class="form-group">
                        <label for="allianceName">Alliance Name:</label>
                        <input type="text" id="allianceName" placeholder="e.g., KLS" maxlength="50" required>
                    </div>

                    <div class="form-group">
                        <label for="pollDescription">Poll Description:</label>
                        <textarea id="pollDescription" placeholder="e.g., Vote for your preferred play times" maxlength="200"></textarea>
                    </div>

                    <button class="btn btn-primary" onclick="createPoll()">Create Poll</button>
                </div>
            </div>

            <!-- Poll Screen -->
            <div id="pollScreen" style="display: none;">
                <div class="poll-info">
                    <h3 id="pollTitle">Alliance Poll</h3>
                    <p id="pollDesc"></p>
                    <div class="share-link">
                        <input type="text" id="shareableLink" readonly>
                        <button class="copy-btn" onclick="copyLink()">Copy Link</button>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.9em;">Share this link with your alliance members!</p>
                </div>

                <div id="message"></div>

                <div class="instructions">
                    <strong>Instructions:</strong> Enter your name and select all time slots when you're available to play.
                </div>

                <div class="name-input-section">
                    <label for="playerName">Your In-Game Name:</label>
                    <input type="text" id="playerName" placeholder="Enter your name..." maxlength="50">
                </div>

                <div id="timeSlots"></div>

                <button class="btn btn-primary" id="submitBtn" onclick="submitVote()">Submit Your Vote</button>

                <div class="results-section" id="resultsSection" style="display: none;">
                    <div class="results-title">Current Results</div>
                    <div id="results"></div>
                </div>
            </div>

            <div id="errorScreen" style="display: none;">
                <div class="error-box">
                    <h3>Poll Not Found</h3>
                    <p>The poll you're looking for doesn't exist or has been deleted.</p>
                    <button class="btn btn-primary" onclick="location.href = window.location.pathname" style="margin-top: 20px; width: auto;">Go Back</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Password Modal -->
    <div class="modal" id="passwordModal">
        <div class="modal-content">
            <h2>Poll Created Successfully!</h2>
            <p><strong>Important:</strong> Save these credentials now. You'll need them to access the admin panel.</p>
            
            <div class="credential-display">
                <label>Poll ID:</label>
                <div class="value">
                    <span id="modalPollId"></span>
                    <button class="copy-btn" onclick="copyModalCredential('pollId')">Copy</button>
                </div>
            </div>

            <div class="credential-display">
                <label>Admin Password:</label>
                <div class="value">
                    <span id="modalPassword"></span>
                    <button class="copy-btn" onclick="copyModalCredential('password')">Copy</button>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn btn-primary" onclick="closePasswordModal()">Got it!</button>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmationModal">
        <div class="modal-content">
            <h2>Confirm Your Vote</h2>
            <p>You've selected <strong id="confirmSlotCount">0</strong> time slot(s). Once submitted, your vote will be recorded.</p>
            
            <div class="modal-actions">
                <button class="btn btn-outline" onclick="closeConfirmationModal()">Cancel</button>
                <button class="btn btn-primary" onclick="confirmSubmitVote()">Confirm Vote</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { firebaseConfig } from './firebase-config.js';

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Make Firebase available globally
        window.firebaseDB = database;
        window.firebaseRef = ref;
        window.firebaseSet = set;
        window.firebaseGet = get;
        window.firebaseOnValue = onValue;
        window.firebaseUpdate = update;

        // Initialize app
        window.initializeApp();
    </script>

    <script>
        let currentPollId = null;
        let selectedSlots = new Set();
        let pollData = null;

        // Generate 48 time slots (30 minutes each)
        const timeSlots = [];
        for (let i = 0; i < 48; i++) {
            const startHour = Math.floor(i / 2);
            const startMin = (i % 2) * 30;
            const endHour = Math.floor((i + 1) / 2);
            const endMin = ((i + 1) % 2) * 30;
            
            const startTime = `${String(startHour).padStart(2, '0')}:${String(startMin).padStart(2, '0')}`;
            const endTime = `${String(endHour).padStart(2, '0')}:${String(endMin).padStart(2, '0')}`;
            
            timeSlots.push({
                id: i + 1,
                label: `${startTime} - ${endTime}`,
                time: `${startTime}-${endTime}`
            });
        }

        // Initialize application
        window.initializeApp = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const pollId = urlParams.get('poll');

            if (pollId) {
                currentPollId = pollId;
                loadPoll(pollId);
            } else {
                showCreateSection();
            }
        }

        // Generate unique poll ID
        function generatePollId() {
            const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
            let id = '';
            for (let i = 0; i < 6; i++) {
                id += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return id;
        }

        // Create new poll
        window.createPoll = async function() {
            const allianceName = document.getElementById('allianceName').value.trim();
            const description = document.getElementById('pollDescription').value.trim();

            if (!allianceName) {
                showMessage('Please enter an alliance name!', 'error');
                return;
            }

            const pollId = generatePollId();
            const pollRef = window.firebaseRef(window.firebaseDB, `polls/${pollId}`);

            const newPoll = {
                id: pollId,
                allianceName: allianceName,
                description: description || 'Vote for your preferred play times',
                createdAt: new Date().toISOString(),
                votes: {},
                adminPassword: generatePassword(),
                resultsVisible: false  // Results hidden by default
            };

            try {
                await window.firebaseSet(pollRef, newPoll);
                
                // Show success message with password
                showPasswordModal(pollId, newPoll.adminPassword);
                
                // Update URL and load poll
                window.history.pushState({}, '', `?poll=${pollId}`);
                currentPollId = pollId;
                loadPoll(pollId);
            } catch (error) {
                console.error('Error creating poll:', error);
                showMessage('Error creating poll. Please try again.', 'error');
            }
        }

        // Join existing poll
        window.joinPoll = function() {
            const pollId = document.getElementById('pollIdInput').value.trim().toUpperCase();
            
            if (!pollId || pollId.length !== 6) {
                showMessage('Please enter a valid 6-character Poll ID!', 'error');
                return;
            }

            window.history.pushState({}, '', `?poll=${pollId}`);
            currentPollId = pollId;
            loadPoll(pollId);
        }

        // Load poll data
        async function loadPoll(pollId) {
            showLoadingScreen();

            try {
                const pollRef = window.firebaseRef(window.firebaseDB, `polls/${pollId}`);
                const snapshot = await window.firebaseGet(pollRef);

                if (snapshot.exists()) {
                    pollData = snapshot.val();
                    
                    // Listen for real-time updates
                    window.firebaseOnValue(pollRef, (snapshot) => {
                        if (snapshot.exists()) {
                            pollData = snapshot.val();
                            updatePollDisplay();
                        }
                    });

                    showPollScreen();
                } else {
                    showErrorScreen();
                }
            } catch (error) {
                console.error('Error loading poll:', error);
                showErrorScreen();
            }
        }

        // Show different screens
        function showLoadingScreen() {
            document.getElementById('loadingScreen').style.display = 'block';
            document.getElementById('createSection').style.display = 'none';
            document.getElementById('pollScreen').style.display = 'none';
            document.getElementById('errorScreen').style.display = 'none';
        }

        function showCreateSection() {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('createSection').style.display = 'block';
            document.getElementById('pollScreen').style.display = 'none';
            document.getElementById('errorScreen').style.display = 'none';
        }

        function showPollScreen() {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('createSection').style.display = 'none';
            document.getElementById('pollScreen').style.display = 'block';
            document.getElementById('errorScreen').style.display = 'none';

            // Update poll info
            document.getElementById('pollTitle').textContent = pollData.allianceName;
            document.getElementById('pollDesc').textContent = pollData.description;
            document.getElementById('shareableLink').value = window.location.href;

            updatePollDisplay();
        }

        function showErrorScreen() {
            document.getElementById('loadingScreen').style.display = 'none';
            document.getElementById('createSection').style.display = 'none';
            document.getElementById('pollScreen').style.display = 'none';
            document.getElementById('errorScreen').style.display = 'block';
        }

        // Update poll display
        function updatePollDisplay() {
            renderTimeSlots();
            
            // Show/hide results based on resultsVisible setting
            const resultsSection = document.getElementById('resultsSection');
            if (pollData.resultsVisible) {
                resultsSection.style.display = 'block';
                updateResults();
            } else {
                resultsSection.style.display = 'none';
            }
        }

        // Update results display
        function updateResults() {
            const resultsDiv = document.getElementById('results');
            const votes = pollData.votes || {};
            
            if (Object.keys(votes).length === 0) {
                resultsDiv.innerHTML = '<p style="color: #888; text-align: center;">No votes yet. Be the first to vote!</p>';
                return;
            }

            const slotResults = timeSlots.map(slot => {
                const voters = Object.entries(votes)
                    .filter(([name, data]) => data.slots && data.slots.includes(slot.id))
                    .map(([name]) => name);
                
                return {
                    slot,
                    voters,
                    count: voters.length
                };
            }).sort((a, b) => b.count - a.count);

            resultsDiv.innerHTML = slotResults.map(result => `
                <div style="margin-bottom: 20px;">
                    <div style="font-weight: 600; color: #ffffff; margin-bottom: 5px;">
                        ${result.slot.label}: ${result.count} vote${result.count !== 1 ? 's' : ''}
                    </div>
                    ${result.voters.length > 0 ? `
                        <div class="voter-list">
                            ${result.voters.join(', ')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        // Render time slots
        function renderTimeSlots() {
            const container = document.getElementById('timeSlots');
            const votes = pollData.votes || {};
            
            container.innerHTML = timeSlots.map(slot => {
                const voteCount = Object.values(votes).filter(v => v.slots && v.slots.includes(slot.id)).length;
                const isSelected = selectedSlots.has(slot.id);

                return `
                    <div class="time-slot ${isSelected ? 'selected' : ''}" id="slot-${slot.id}" onclick="toggleSlot(${slot.id})">
                        <div class="time-info">
                            <span class="time-label">${slot.label}</span>
                            <span class="vote-count">${voteCount} vote${voteCount !== 1 ? 's' : ''}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Toggle time slot selection
        window.toggleSlot = function(slotId) {
            const slotElement = document.getElementById(`slot-${slotId}`);
            
            if (selectedSlots.has(slotId)) {
                selectedSlots.delete(slotId);
                slotElement.classList.remove('selected');
            } else {
                selectedSlots.add(slotId);
                slotElement.classList.add('selected');
            }
        }

        // Submit vote - show confirmation first
        window.submitVote = function() {
            const playerName = document.getElementById('playerName').value.trim();
            
            if (!playerName) {
                showMessage('Please enter your name!', 'error');
                return;
            }

            if (selectedSlots.size === 0) {
                showMessage('Please select at least one time slot!', 'error');
                return;
            }

            // Show confirmation modal
            document.getElementById('confirmSlotCount').textContent = selectedSlots.size;
            document.getElementById('confirmationModal').classList.add('active');
        }

        // Confirm and actually submit vote
        window.confirmSubmitVote = async function() {
            const playerName = document.getElementById('playerName').value.trim();
            
            closeConfirmationModal();

            try {
                const voteRef = window.firebaseRef(window.firebaseDB, `polls/${currentPollId}/votes/${playerName}`);
                await window.firebaseSet(voteRef, {
                    slots: Array.from(selectedSlots),
                    timestamp: new Date().toISOString()
                });

                showMessage(`Thank you, ${playerName}! Your vote has been recorded.`, 'success');
                
                // Reset form
                document.getElementById('playerName').value = '';
                selectedSlots.clear();
                
                renderTimeSlots();
            } catch (error) {
                console.error('Error submitting vote:', error);
                showMessage('Error submitting vote. Please try again.', 'error');
            }
        }

        // Show password modal after poll creation
        function showPasswordModal(pollId, password) {
            document.getElementById('modalPollId').textContent = pollId;
            document.getElementById('modalPassword').textContent = password;
            document.getElementById('passwordModal').classList.add('active');
        }

        // Close password modal
        window.closePasswordModal = function() {
            document.getElementById('passwordModal').classList.remove('active');
        }

        // Close confirmation modal
        window.closeConfirmationModal = function() {
            document.getElementById('confirmationModal').classList.remove('active');
        }

        // Copy modal credentials
        window.copyModalCredential = function(type) {
            const text = type === 'pollId' ? 
                document.getElementById('modalPollId').textContent : 
                document.getElementById('modalPassword').textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                showMessage(`${type === 'pollId' ? 'Poll ID' : 'Password'} copied to clipboard!`, 'success');
            });
        }

        // Copy shareable link
        window.copyLink = function() {
            const linkInput = document.getElementById('shareableLink');
            linkInput.select();
            document.execCommand('copy');
            showMessage('Link copied to clipboard!', 'success');
        }

        // Show message
        function showMessage(text, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            setTimeout(() => {
                messageDiv.className = '';
                messageDiv.textContent = '';
            }, 5000);
        }

        // Generate admin password
        function generatePassword() {
            const chars = 'ABCDEFGHJKMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789';
            let password = '';
            for (let i = 0; i < 8; i++) {
                password += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return password;
        }
    </script>
</body>
</html>
